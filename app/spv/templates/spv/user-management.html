{% extends "layouts/app.html" %} {% block content %}
<style>
  html, body {
    height: 100%;
    overflow: hidden; 
    background-color: #f8f9fa;
  }

  .dashboard-wrapper {
    height: calc(100vh - 100px);
    display: flex;
    flex-direction: column;
    padding-top: 1rem;
    overflow: hidden;
  }

  .management-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    min-height: 0;
  }

  .section-requests {
    flex: 0 0 220px; 
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .section-active {
    flex: 1; 
    display: flex;
    flex-direction: column;
    min-height: 0;
  }

  .card {
    border-radius: 15px;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    background: white;
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden; 
  }

  .card-header {
    background-color: white !important;
    border-bottom: 1px solid #f1f1f1 !important;
    padding: 0.8rem 1.25rem !important;
    flex-shrink: 0;
  }

  .card-body-scroll {
    flex: 1;
    overflow-y: scroll; /* Tetap dipaksa agar lebar area konten identik */
    overflow-x: hidden;
    position: relative;
  }

  .card-body-scroll::-webkit-scrollbar { width: 6px; }
  .card-body-scroll::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 10px; }

  .table thead th {
    background-color: #fcfcfc !important;
    border-top: none;
    padding: 0.75rem 1.25rem;
    position: sticky;
    top: 0;
    z-index: 1020;
    box-shadow: inset 0 -1px 0 #f1f1f1;
  }

  /* KUNCI SINKRONISASI LEBAR DAN ALIGNMENT */
  .col-name { width: 35%; }
  .col-email { width: 40%; }
  .col-action-status { width: 25%; text-align: center; } /* Disamakan rata tengah */

  .table-responsive { overflow: visible !important; }
  .status-badge { padding: 5px 12px; border-radius: 8px; font-size: 0.7rem; font-weight: 600; }
  .bg-warning-soft { background-color: #fff3cd; color: #856404; }
  .bg-success-soft { background-color: #e8f5e9; color: #198754; }
  .stats-label { font-size: 0.65rem; color: #adb5bd; text-transform: uppercase; font-weight: 700; }
  
  .btn-approve { background-color: #198754; color: white; font-weight: 600; font-size: 0.7rem; border-radius: 8px; border: none; padding: 4px 12px; }
  .btn-reject { color: #dc3545; font-weight: 600; font-size: 0.7rem; background: none; border: none; }
  .row { margin-right: 0; margin-left: 0; }
</style>

<div class="container py-3 dashboard-wrapper">
  <div class="row align-items-center mb-3 flex-shrink-0">
    <div class="col-md-7">
      <h2 class="fw-bold text-dark mb-1">User Management</h2>
      <p class="text-muted small mb-0">Manage <span class="fw-bold text-primary">Staff Permissions</span></p>
    </div>
    <div class="col-md-5 text-md-end">
      <div class="d-inline-flex gap-3">
        <div class="text-end">
          <span class="stats-label d-block">Pending</span>
          <h4 class="fw-bold text-warning mb-0">{{ pending_users|length }}</h4>
        </div>
        <div class="vr opacity-25"></div>
        <div class="text-end">
          <span class="stats-label d-block">Active Staff</span>
          <h4 class="fw-bold text-success mb-0">{{ active_users|length }}</h4>
        </div>
      </div>
    </div>
  </div>

  <div class="management-content">
    
    <div class="section-requests">
      <div class="card shadow-sm">
        <div class="card-header">
          <h6 class="fw-bold mb-0 text-dark" style="font-size: 0.85rem;">
            <i class="bi bi-person-plus-fill text-warning me-2"></i>Access Requests
          </h6>
        </div>
        <div class="card-body-scroll">
          <div class="table-responsive">
            <table class="table align-middle mb-0" style="table-layout: fixed; width: 100%;">
              <thead>
                <tr class="stats-label">
                  <th class="ps-4 col-name">Staff Name</th>
                  <th class="col-email">Email</th>
                  <th class="col-action-status pe">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% if pending_users %}
                  {% for user in pending_users %}
                  <tr>
                    <td class="ps-4 py-2 text-truncate">
                      <div class="fw-bold text-dark small">{{ user.name }}</div>
                      <small class="text-muted" style="font-size: 0.6rem;">ID: {{ user.user_id }}</small>
                    </td>
                    <td class="text-muted small text-truncate">{{ user.email }}</td>
                    <td class="col-action-status pe">
                      <div class="d-flex justify-content-center align-items-center gap-2">
                        <form action="{{ url_for('spv.approve_user', user_id=user.user_id) }}" method="POST" class="m-0">
                          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                          <button type="submit" class="btn btn-approve">Approve</button>
                        </form>
                        <form action="{{ url_for('spv.reject_user', user_id=user.user_id) }}" method="POST" class="m-0">
                          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                          <button type="submit" class="btn btn-reject">Reject</button>
                        </form>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                <tr><td colspan="3" class="text-center py-5 text-muted small italic">No pending requests.</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="section-active">
      <div class="card shadow-sm">
        <div class="card-header">
          <h6 class="fw-bold mb-0 text-dark" style="font-size: 0.85rem;">
            <i class="bi bi-people-fill text-success me-2"></i>Active Staff Officers
          </h6>
        </div>
        <div class="card-body-scroll">
          <div class="table-responsive">
            <table class="table align-middle mb-0" style="table-layout: fixed; width: 100%;">
              <thead>
                <tr class="stats-label">
                  <th class="ps-4 col-name">Full Name</th>
                  <th class="col-email">Email</th>
                  <th class="col-action-status pe">Status</th>
                </tr>
              </thead>
              <tbody>
                {% if active_users %}
                  {% for user in active_users %}
                  <tr>
                    <td class="ps-4 py-3 text-truncate">
                      <span class="fw-bold text-dark small">{{ user.name }}</span>
                    </td>
                    <td class="text-muted small text-truncate">{{ user.email }}</td>
                    <td class="col-action-status pe">
                      <span class="status-badge bg-success-soft">ACTIVE</span>
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                <tr><td colspan="3" class="text-center py-5 text-muted small italic">No active staff.</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}